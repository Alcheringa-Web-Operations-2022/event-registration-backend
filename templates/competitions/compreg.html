{% extends '../basictailwind.html'%}
{%block title%}Register for {{comp.event_name}} {%endblock%}
{% block body %}
<style>
    input{
       border: none;
       border-bottom: 1px solid rgb(214, 206, 206);
       margin: 16px 0px;
   }
   input:focus{
    outline: none;
    }
</style>
<body x-data="{ showModal: false}" :class="{'overflow-y-hidden': showModal}">
    <div class="bg-blue-50 flex">
        {% include "../navbar.html" %}
        <div class="flex">
            <div class="flex-grow">
                <div class="bg-white flex bg-gray-50 flex-grow">
                    <div class="mx-4 flex-grow">
                        <br>
                        <!-- Content here -->
                        <div class="flex m-1">
                            <div class=" bg-white max-w-4xl rounded-lg w-screen shadow-md">
                                <div>
                                    <div class="py-3 pl-6  text-xl border-b-2 font-normal">Register</div>
                                    <div class="mx-10">
                                        <div class="container">
                                        <form id="add-member-form"> 
                                            <div class="flex flex-col justify-center">
                                                <div
                                                    class="relative flex flex-col md:flex-row md:space-x-5 space-y-3 md:space-y-0 p-3 max-w-xs md:max-w-3xl mx-auto border border-white bg-white">
                                                    <div class="w-full md:w-1/3 bg-white grid place-items-center">
                                                        <img src="{{comp.image.url}}" class="rounded-xl" />
                                                    </div>
                                                    <div class="w-full md:w-2/3 bg-white flex flex-col space-y-2 p-3">
                                                        
                                                        <h3 class="font-medium md:text-3xl text-xl">{{comp.event_name}}</h3>
                                                        <p class="md:text-lg text-gray-500 text-base">{{comp.module}} &#xb7; <span style="color: #EE6337;text-decoration:none;"><a href="www.facebook.com" class="cursor-pointer">View Rules</a></span></p>
                                                        <p class="md:text-lg text-gray-500 text-base">
                                                            {%if comp.min_members == 1 and comp.max_members == 1 %}
                                                            <i class="fa fa-user" aria-hidden="true"></i> Single
                                                            {%else%}
                                                            <i class="fa fa-users" aria-hidden="true"></i> Group {{comp.min_members}}-{{comp.max_members}} members
                                                            {%endif%}
                                                                &#xb7; 
                                                            <i class="fas fa-map-marker-alt" aria-hidden="true" style="color:green;"></i><span style="text-gray-600"> {{comp.location}}</span>
                                                            
                                                        </p>
                                                        <p class="text-xl text-gray-800">
                                                            
                                                            <span class="font-normal text-gray-600 text-base">Total prizes worth</span><br>
                                                            <span class="font-medium">â‚¹{{comp.prize_worth}}</span>
                                                        </p>
                                                        
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="p-3 mx-auto border border-white bg-white">
                                                <div class="font-normal text-gray-600 text-base">Team Name *</div>
                                                <input type="text" class="w-full" name="teamname" id="teamname" placeholder="Enter Team Name*"                        required>
                                                <div class="font-normal text-gray-600 text-base">Add members (Min. {{comp.min_members}} - Max. {{comp.max_members}}) *</div>
                                                <!-- Chips -->
                                                <div class="flex flex-wrap justify-start space-x-2 items-end" id="chip-team"></div>
                                                <div class="py-3 px-6 my-3 border-dotted border-2 font-normal w-full text-center cursor-pointer" @click="showModal = true">Add/Remove member(s)</div>
                                                <input type="submit"
                                                    class="bg-red-600 hover:bg-red-700 text-white inline-block py-2 px-4 rounded shadow-sm font-semibold text-base"/>
                                            </div>
                                        </form>

                                        
                                        </div>

                                    </div>

                                    
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal for adding members -->
    <div class="fixed inset-0 w-full h-full z-20 bg-black bg-opacity-50 duration-300 overflow-y-auto" id="addmodal"x-show="showModal"
        x-transition:enter="transition duration-300" x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100" x-transition:leave="transition duration-300"
        x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0">
        <div class="relative sm:w-3/4 md:w-3/4 lg:w-3/4 mx-2 sm:mx-auto my-10 opacity-100">
            <div class="relative bg-white shadow-lg rounded-md text-gray-900 z-20" @click.away="showModal = false"
                x-show="showModal" x-transition:enter="transition transform duration-300" x-transition:enter-start="scale-0"
                x-transition:enter-end="scale-100" x-transition:leave="transition transform duration-300"
                x-transition:leave-start="scale-100" x-transition:leave-end="scale-0">
                <header class="flex items-center justify-between p-2">
                    <h2 class="font-semibold">Add members from your team</h2>
                    <button class="focus:outline-none p-2" @click="showModal = false">
                        <svg class="fill-current" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18">
                            <path
                                d="M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z">
                            </path>
                        </svg>
                    </button>
                </header>
                <div class="mx-4 my-2 bg-blue-50 rounded-sm">
                    <span class="float-left p-1">
                        <svg width="20" height="20" viewBox="0 0 20 21" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-1">
                            <path
                                d="M12.9167 12.1667H12.2583L12.025 11.9417C12.8417 10.9917 13.3333 9.75833 13.3333 8.41667C13.3333 5.425 10.9083 3 7.91667 3C4.925 3 2.5 5.425 2.5 8.41667C2.5 11.4083 4.925 13.8333 7.91667 13.8333C9.25833 13.8333 10.4917 13.3417 11.4417 12.525L11.6667 12.7583V13.4167L15.8333 17.575L17.075 16.3333L12.9167 12.1667ZM7.91667 12.1667C5.84167 12.1667 4.16667 10.4917 4.16667 8.41667C4.16667 6.34167 5.84167 4.66667 7.91667 4.66667C9.99167 4.66667 11.6667 6.34167 11.6667 8.41667C11.6667 10.4917 9.99167 12.1667 7.91667 12.1667Z"
                                fill="#C2CFE0" />
                        </svg>
                    </span>
                    <span>
                        <input type="search" class="py-1 bg-blue-50 font-light text-base" placeholder="search member" />
                    </span>
                </div>
                <div class="p-3 grid grid-cols-1 sm:grid-cols-2">
                    <!-- single-card-orange_border -->
                    <div class="m-1 p-3 flex bg-white bg-blue-50 border-red-500 border-2 rounded-md relative cursor-pointer">
                        <img width="70" height="70" src="https://i.ibb.co/BzT98sw/image.png" alt="profile" border="0" />
                        <div class="absolute top-0 right-0 h-16 w-16 text-right px-2" id="{{member.id}}"><i class="fa fa-check"
                                aria-hidden="true" style="color:green;"></i></div>
                        <div class="mx-5 my-auto">
                            <div class="font-medium text-xl text-base">Team Leader</div>
                            <div class="font-medium text-base">{{request.user.fullname}}</div>
                            <div class="font-light text-sm">{{request.user.email}}</div>
                        </div>
                    </div>
                    <!-- single-card -->
                    {%for member in team_members%}
                    <div class="m-1 p-3 flex border-2 rounded-md relative cursor-pointer" id="card{{member.id}}"onclick="select('{{member.id}}')">
                        <img width="70" height="70" src="https://i.ibb.co/BzT98sw/image.png" alt="profile" border="0" />
                        <div class="absolute top-0 right-0 h-16 w-16 text-right px-2 invisible"  id="{{member.id}}"><i class="fa fa-check" aria-hidden="true" style="color:green;"></i></div>
                        <div class="mx-5 my-auto">
                            <div class="font-medium text-base">{{member.name}}</div>
                            <div class="font-light text-sm">{{member.email}}</div>
                        </div>
                    </div>
                    {%endfor%}
                    
            
                </div>
                <footer  class="p-2 text-center">
                    <button class="bg-red-600 hover:bg-red-700 text-white inline-block py-2 px-4 rounded shadow-sm font-semibold text-base"id="confirm-select"  @click="showModal = false">Done</button>
                </footer>
            </div>
        </div>       
    </div>
</body>
<script>
    var team = [];
    function select(id){
        document.getElementById(id).classList.toggle("invisible");
        document.getElementById("card"+id).classList.toggle("bg-blue-50")
        document.getElementById("card" + id).classList.toggle("border-red-500") 
        document.getElementById("card" + id).classList.toggle("selected") 
    }
    document.getElementById('confirm-select').addEventListener("click", confirmselect);
    function confirmselect(){
        team=[]
        var elements = document.getElementsByClassName("selected");
        for (var i = 0, len = elements.length; i < len; i++) {
            team.push({'id':elements[i].id.slice(4),'image':elements[i].getElementsByTagName('img')[0].src,'name':elements[i].getElementsByTagName('div')[1].getElementsByTagName('div')[0].innerHTML,'email':elements[i].getElementsByTagName('div')[1].getElementsByTagName('div')[1].innerHTML})
        }
        // console.log(team)
        addchip(team)
    }

    function addchip(team){
        $('#chip-team').empty()
        $.each(team, function (i) {
            var templateString = `<span
    class="mx-4 my-2 rounded-full text-gray-500 bg-gray-200 font-semibold text-sm flex align-center cursor-pointer active:bg-gray-300 transition duration-300 ease w-max">
    <img class="rounded-full w-14 h-14 max-w-none" alt="A"
      src="${team[i].image}" />
    <span class="flex items-center px-3 py-2">
      ${team[i].name}<br>${team[i].email}
    </span>
    
  </span>`;
            $('#chip-team').append(templateString);
        })
    }


    $("#add-member-form").submit(function (event) {
        event.preventDefault();
        if(team.length==0){
            notifyError("ERROR", "Members can't be zero")
            return
        }
        if((team.length+1)<{{comp.min_members}} || (team.length+1)>{{comp.max_members}}){
            notifyError("ERROR", "Members not within valid range")
            return
        }
        $.ajax({
            type: "POST",
            data: {
                'members':JSON.stringify(team),
                'teamname':$("#teamname").val(),
            },

            headers: {
                "X-CSRFTOKEN": "{{ csrf_token }}"
            },
            success:(data)=>{
                window.location.reload()
            }
        })

        
    });
</script>

{%endblock%}
{% block script %}

{% endblock %}